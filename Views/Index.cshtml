
@page "{regionInfo}/{businessId:int}/{entityId:int}"
@inject IHtmlLocalizer<HomeController> Localizer
@using Microsoft.AspNetCore.Mvc.Localization
<!DOCTYPE html>
<html lang="en">
@using System.Globalization;
@using Menu4Tech.Controllers
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X4Y1BZ9DF2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-X4Y1BZ9DF2');
    </script>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
    <title>@ViewBag.MetaPageTitle</title>
    @if (CultureInfo.CurrentCulture.Name.ToUpper() == "HE" || CultureInfo.CurrentCulture.Name.ToUpper() == "HEB")
    {
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.rtl.min.css" integrity="sha384-gXt9imSW0VcJVHezoNQsP+TNrjYXoGcrqBZJpry9zJt8PCQjobwmhMGaDHTASo9N" crossorigin="anonymous">
    }
    else
    {
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
    }
    @if (ViewBag.MetaDescription != null)
    {
        <meta name="description" content="@ViewBag.MetaDescription"/>
    }


    <link rel="stylesheet" href="~/css/style.css?v=2" asp-append-version="true"/>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <script src="~/js/mainpage.js?v=20230709"></script>
    @*<link rel="stylesheet" href="~/css/intlTelInput.css"/>*@
    @*<script type="text/javascript" src="~/js/intlTelInput.js"></script>*@
    @*<script type="text/javascript" src="~/js/utils.js"></script>*@
    <script src="https://cdn.enable.co.il/licenses/enable-L19760o40cadymk3-0523-45594/init.js"></script>
</head>

<body style="overflow-x:hidden">
@* @if (TempData["log"] != null)
    {
        <textarea style="display: none">
            @TempData["log"]
        </textarea>
    }*@

@*@Html.Partial("Header.cshtml")*@
<partial name="Header.cshtml"/>
<div style="overflow-x:hidden">
    <main role="main" class="pb-3">

@model Menu4Tech.Views.IndexModel
@{
    if (ViewData != null)
    {
        ViewData["Title"] = "Home page";
    }
}

<div id="menu">

</div>

<script>
    $body = $("body");

    $(document).ajaxStop(function () {
        $body.removeClass("loading");
    });
    $(document).ready(function () {

        var parameters = window.location.pathname.split('/');
        if (parameters === undefined) return;

        var culture = (parameters.length >= 2) ? parameters[1] : null;

        var businessId = 0;
        var entityId = 0;

     
        businessId = (parameters.length >= 3) ? parameters[2] : null;
        entityId = (parameters.length >= 4) ? parameters[3] : null;
        

        if (businessId === null || entityId === null) {
            $("#error").show();
            return false;
        }

        // Try to load the menu html

        $.ajax({
            type: "Get",
            url: "/Files/" + businessId + "/Menu" + ((culture !== null) ? culture : '') + ".html",
            success: function (response) {
                $('#menu').html(response);
                UpdateMenu(businessId, entityId, culture);
            },
            error: function (xhr, status, error) {
                if (xhr !== undefined && xhr.status === 404) {
                    $body.addClass("loading");
                }
                UpdateMenu(businessId, entityId, culture);
            }
        });


        return false;
    });
    function UpdateMenu(businessId, entityId, culture) {
        $.ajax({
            type: "Get",
            url: "/Menu/GetMenu?businessId=" + businessId + "&entityId=" + entityId + "&culture=" + culture,
            success: function (response) {
                if (response !== undefined && response.isUpdated === true)
                    $('#menu').html(response.content);
            },
            error: function (xhr, status, error) {
                $("#error").show();
            }
        });
    }
</script>

<div id="error" style="display:none">Something is wrong, Please contact administrator</div>
<div class="modal"></div>



    </main>
</div>
@*@Html.Partial("Footer.cshtml")*@
<partial name="Footer.cshtml"/>
@await Component.InvokeAsync("Notyf")
</body>
</html>